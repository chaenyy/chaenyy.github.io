<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chany</title>
    <link rel="stylesheet" href="css/join_style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=East+Sea+Dokdo&family=Hi+Melody&family=Jua&family=Lato:wght@700&family=Luckiest+Guy&family=Nanum+Brush+Script&family=Nanum+Gothic:wght@400;700;800&family=Nanum+Pen+Script&family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Racing+Sans+One&family=Roboto+Mono:ital,wght@0,400;1,500&family=Shrikhand&family=Ultra&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header">
            <h2 class="logo"><a href="index.html">CHANY</a></h2>
            <nav>
                <ul class="headerMenu">
                    <li><a href="introduce.html">INTRODUCE</a></li>
                    <li><a href="travel.html">TRAVEL</a></li>
                    <li><a href="roadmap.html">ROAD-MAP</a></li>
                </ul>
            </nav>
            <div class="loginMenu">
                <div class="loginMemberInfo"></div>
                <div id="loginText" onclick="loginBtn(this);">LOGIN</div>
            </div>
        </div>
    </header>

    <main>
        <div class="content-wrap">
            <h2 class="titleArea">SIGN UP</h2>

            <form action="javascript:saveMemberInfo();" name="joinForm">
                <table>
                    <tbody>
                        <tr>
                            <th>회원구분</th>
                            <td>
                                <input type="radio" name="member-type" id="member-type0" value="일반회원" checked>
                                <label for="member-type0">일반회원</label>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <h3 class="subTitle">기본정보</h3>
                <table>
                    <tbody>
                        <tr>
                            <th>아이디 <span id="req">*</span></th>
                            <td>
                                <input type="text" name="userId" id="userId" required>
                                <span id="idInfo">아이디를 입력해주세요.(영문소문자/숫자,4~16자)</span>
                            </td>
                        </tr>
                        <tr>
                            <th>비밀번호 <span id="req">*</span></th>
                            <td>
                                <input type="password" name="userPwd" id="userPwd" required>
                                <span id="pwdInfo">(영문 대문자 혹은 소문자/숫자/특수문자를 포함한 8~16자)</span>
                            </td>
                        </tr>
                        <tr>
                            <th>비밀번호 확인 <span id="req">*</span></th>
                            <td>
                                <input type="password" name="userPwdCheck" id="userPwdCheck" required>
                                <span id="pwdCheckInfo"></span>
                            </td>
                        </tr>
                        <tr>
                            <th>비밀번호 확인 질문 <span id="req">*</span></th>
                            <td>
                                <select name="userPwd_Question" id="userPwd_Question" required>
                                    <option value="hint_1" selected>기억에 남는 추억의 장소는?</option>
                                    <option value="hint_2">자신의 인생 좌우명은?</option>
                                    <option value="hint_3">자신의 보물 제 1호는?</option>
                                    <option value="hint_4">가장 기억에 남는 선생님 성함은?</option>
                                    <option value="hint_5">내가 좋아하는 캐릭터는?</option>
                                    <option value="hint_6">타인이 모르는 나만의 신체비밀은?</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th>비밀번호 확인 답변 <span id="req">*</span></th>
                            <td>
                                <input type="text" name="userPwd_Answer" id="userPwd_Answer" required>
                            </td>
                        </tr>
                        <tr>
                            <th>이름 <span id="req">*</span></th>
                            <td>
                                <input type="text" name="userName" id="userName" required>
                                <span id="userNameInfo"></span>
                            </td>
                        </tr>
                        <tr>
                            <th>일반전화</th>
                            <td>
                                <select name="phone_front" id="phone_front">
                                    <option value="02" selected>02</option>
                                    <option value="031">031</option>
                                    <option value="032">032</option>
                                    <option value="033">033</option>
                                    <option value="041">041</option>
                                    <option value="042">042</option>
                                    <option value="044">044</option>
                                    <option value="051">051</option>
                                    <option value="052">052</option>
                                    <option value="053">053</option>
                                    <option value="054">054</option>
                                    <option value="055">055</option>
                                    <option value="061">061</option>
                                    <option value="062">062</option>
                                    <option value="063">063</option>
                                </select>
                                -
                                <input type="tel" name="phone" id="phone_middle" maxlength="4">
                                -
                                <input type="tel" name="phone" id="phone_last" maxlength="4">
                                <span id="phoneInfo"></span>
                            </td>
                        </tr>
                        <tr>
                            <th>휴대전화 <span id="req">*</span></th>
                            <td>
                                <select name="mobile_front" id="mobile_front" required>
                                    <option value="010" selected>010</option>
                                    <option value="011">011</option>
                                    <option value="016">016</option>
                                    <option value="017">017</option>
                                    <option value="018">018</option>
                                    <option value="019">019</option>
                                </select>
                                -
                                <input type="tel" name="mobile" id="mobile_middle" maxlength="4" required>
                                -
                                <input type="tel" name="mobile" id="mobile_last" maxlength="4" required>
                                <span id="mobileInfo"></span>
                            </td>
                        </tr>
                        <tr>
                            <th>이메일 <span id="req">*</span></th>
                            <td>
                                <input type="email" name="userEmail" id="userEmail" required>
                                <span id="emailInfo"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="finalJoin">
                    <button id="finalJoinBtn">회원가입</button>
                </div>
            </form>
        </div>
    </main>

    <footer class="footer-section">
        <div class="footer-wrap">
            <div class="footer-top">
                <div class="footer-top-title">상호명 : 채니 ㈜</div>
                <div class="footer-right-border"></div>
                <div class="footer-top-title">대표이사 : 박채은</div>
                <div class="footer-right-border"></div>
                <div class="footer-top-title">사업자등록번호 : 123-45-67890</div>
                <div class="footer-right-border"></div>
                <div class="footer-top-title">통신판매업 신고번호 : 서울 강남 제 2014-01호</div>
            </div>
            <div class="footer-bottom">
                <div class="footer-bottom-title">주소 : 서울특별시 강남구 테헤란로14길 6 남도빌딩 5층 채니 ㈜</div>
                <div class="footer-right-border"></div>
                <div class="footer-bottom-title">제휴문의 : 070-9876-5432</div>
                <div class="footer-right-border"></div>
                <div class="footer-bottom-title">이메일 : chaeeun0119@chany.com</div>
            </div>
            <div class="footer-copyright">Copyright 2022 CHANY. All Rights Reserved.</div>
        </div>
    </footer>

    <script>
    // 아이디 유효성 검사
    document.querySelector("#userId").addEventListener('blur', (event) => {
        const inputId = event.target;
        
        if(!inputId.value) return;
        
        if(!/^[a-z][a-z\d]{4,16}$/g.test(inputId.value)) {
            idInfo.innerHTML = '아이디는 영문소문자/숫자 4자리 이상 16자리 이하로 입력해주세요.';
            idInfo.style.color = 'lightcoral';
            inputId.select();
            return;
        } else {
            const members = JSON.parse(localStorage.getItem("members"));
            if(members) {
                for(const member of members) {
                    if(inputId.value === member.userId) {
                        idInfo.innerHTML = `<strong>${inputId.value}</strong>는 이미 사용 중인 아이디입니다.`;
                        inputId.select();
                        idInfo.style.color = 'lightcoral';
                        return;
                    }
                }
            }
            idInfo.innerHTML = `<strong>${inputId.value}</strong>는 사용 가능한 아이디입니다.`;
            idInfo.style.color = '';
        }
    });

    // 비밀번호 유효성 검사
    document.querySelector("#userPwd").addEventListener('blur', (event) => {
        const inputPwd = event.target;

        if(!inputPwd.value) return;

        const regExpArr = [/[^{8,16}]$/g, /[0-9]/g, /[a-zA-Z]/g, /[!@#$%^&*]/g];

        let trueCnt = 0;
        for(let i = 0; i < regExpArr.length; i++) {
            if(!regExpArr[i].test(inputPwd.value)) {
                pwdInfo.innerHTML = '비밀번호는 대문자 혹은 소문자/숫자/특수문자를 모두 포함한 8자리 이상 16자리 이하로 입력해주세요.';
                pwdInfo.style.color = 'lightcoral';
                inputPwd.select();
                trueCnt = 0;
                return;
            } else ++trueCnt;
            
            if(trueCnt == 4) {
                pwdInfo.innerHTML = '사용 가능한 비밀번호입니다.';
                pwdInfo.style.color = '';
            }
        };
    });

    // 비밀번호 일치 검사
    document.querySelector("#userPwdCheck").addEventListener('blur', (event) => {
        if(event.target.value == "") {
            pwdCheckInfo.innerHTML = '';
            pwdCheckInfo.style.color = '';
            return;
        }

        if(document.querySelector("#userPwd").value !== event.target.value) {
            pwdCheckInfo.innerHTML = '비밀번호가 일치하지 않습니다.';
            pwdCheckInfo.style.color = 'lightcoral';
            event.target.select();
            return;
        } else if(document.querySelector("#userPwd").value === event.target.value) {
            pwdCheckInfo.innerHTML = '';
            pwdCheckInfo.style.color = '';
        }
    });

    // 이름 유효성 검사
    document.querySelector("#userName").addEventListener('blur', (event) => {
        const inputName = event.target;

        if(!inputName.value) return;

        if(!/^[가-힣]{2,6}$/.test(inputName.value)) {
            userNameInfo.innerHTML = '이름은 한글 2자리 이상 6자리 이하로 입력해주세요.';
            userNameInfo.style.color = 'lightcoral';
            inputName.select();
            return;
        } else {
            userNameInfo.innerHTML = '';
            userNameInfo.style.color = '';
        }
    });

    // 일반전화 유효성 검사
    document.querySelectorAll("[name=phone]").forEach((querySelector) => {
        querySelector.addEventListener('blur', (event) => {
            const inputPhone = event.target;

            if(!inputPhone.value) {
                phoneInfo.innerHTML = '';
                phoneInfo.style.color = '';
                return;
            }

            if(!/^[0-9]{3,4}$/.test(inputPhone.value)) {
                phoneInfo.innerHTML = '일반전화는 3자리 이상 4자리 이하 숫자만 입력해주세요.';
                phoneInfo.style.color = 'lightcoral';
                inputPhone.select();
                return;
            } else if(/^[0-9]{3,4}$/.test(inputPhone.value)) {
                phoneInfo.innerHTML = '';
                phoneInfo.style.color = '';
            }
        });
    });

    // 휴대전화 유효성 검사
    document.querySelectorAll("[name=mobile]").forEach((querySelector) => {
        querySelector.addEventListener('blur', (event) => {
            const inputMobile = event.target;

            if(!inputMobile.value) return;

            if(!/^[0-9]{3,4}$/.test(inputMobile.value)) {
                mobileInfo.innerHTML = '휴대전화는 3자리 이상 4자리 이하 숫자만 입력해주세요.';
                mobileInfo.style.color = 'lightcoral';
                inputMobile.select();
                return;
            } else if(/^[0-9]{3,4}$/.test(inputMobile.value)) {
                mobileInfo.innerHTML = '';
                mobileInfo.style.color = '';
            }
        });
    }); 

    // 이메일 유효성 검사
    document.querySelector("#userEmail").addEventListener('blur', (event) => {
        const inputEmail = event.target;

        if(!inputEmail) return;

        if(!/^[\w]{3,}@[\w]+(\.[\w]+){1,3}$/.test(inputEmail.value)) {
            emailInfo.innerHTML = '이메일 양식에 맞지 않습니다.';
            emailInfo.style.color = 'lightcoral';
            inputEmail.select();
            return;
        } else if(/^[\w]{3,}@[\w]+(\.[\w]+){1,3}$/.test(inputEmail.value)) {
            emailInfo.innerHTML = '';
            emailInfo.style.color = '';
        }
    });

    // 유효성 검사
    document.joinForm.onsubmit = () => {
        if(!userId.value || !userPwd.value || !userPwd_Question || !userPwd_Answer || !userName || !mobile_front || !mobile_middle || !mobile_last || !userEmail) {
            alert('필수사항(*)을 반드시 입력해주세요.');
            return false;
        }
        alert('회원가입이 완료 되었습니다. 로그인을 진행해주세요.');
        window.location.href = "login.html";
    }

    class Member {
        constructor(userId, userPwd, userPwd_Question, userPwd_Answer, userName, phoneNumber, mobileNumber, userEmail) {
            this.userId = userId;
            this.userPwd = userPwd;
            this.userPwd_Question = userPwd_Question;
            this.userPwd_Answer = userPwd_Answer; 
            this.userName = userName;
            this.phoneNumber = phoneNumber;
            this.mobileNumber = mobileNumber;
            this.userEmail = userEmail;
        }
    };

    const questionText = (inputQuestion) => {
        let question = '';
        switch(inputQuestion) {
            case 'hint_1' : question = "기억에 남는 추억의 장소는?"; break;
            case 'hint_2' : question = "자신의 인생 좌우명은?"; break;
            case 'hint_3' : question = "자신의 보물 제 1호는?"; break;
            case 'hint_4' : question = "가장 기억에 남는 선생님 성함은?"; break;
            case 'hint_5' : question = "내가 좋아하는 캐릭터는?"; break;
            case 'hint_6' : question = "타인이 모르는 나만의 신체비밀은?"; break;
        }
        return question;
    }
    
    // 정보 저장
    const saveMemberInfo = () => {
        const userIdVal = userId.value;
        const userPwdVal = userPwd.value;
        const userPwd_QuestionVal = questionText(userPwd_Question.value);
        const userPwd_AnswerVal = userPwd_Answer.value;
        const userNameVal = userName.value;
        const phone_numberVal = phone_front.value + phone_middle.value + phone_last.value; 
        const mobile_numberVal = mobile_front.value + mobile_middle.value + mobile_last.value; 
        const userEmailVal = userEmail.value;

        const member = new Member(userIdVal, userPwdVal, userPwd_QuestionVal, userPwd_AnswerVal, userNameVal, phone_numberVal, mobile_numberVal, userEmailVal);

        const members = JSON.parse(localStorage.getItem("members")) || [];
        members.push(member);

        const memberData = JSON.stringify(members);

        localStorage.setItem('members', memberData);
        document.joinForm.reset();
    };

    // 로그인 시 헤더에 표시
    const loginInfo = () => {
        const loginData = JSON.parse(localStorage.getItem("loginInfo"));
        const loginMemberInfoDiv = document.querySelector(".loginMemberInfo");
        
        if(loginData) {
            if(loginData.permission === 'normal') {
                loginMemberInfoDiv.innerHTML = `<a href='myPage.html'>${loginData.userName}</a>님, 환영합니다!`;
                loginText.innerHTML = `LOGOUT`;
            } else if(loginData.permission === 'admin') {
                loginMemberInfoDiv.innerHTML = `<a href='managerPage.html'>매니저 ${loginData.managerId}</a> 계정으로 접속되었습니다.`;
                loginText.innerHTML = `LOGOUT`;
            }
        } else {
            loginMemberInfoDiv.innerHTML = '';
            loginText.innerHTML = 'LOGIN';
        }
    };
    
    loginInfo();

    const loginBtn = (element) => {
        const loginMemberInfoDiv = document.querySelector(".loginMemberInfo");
        
        if(element.innerHTML === 'LOGIN') {
            window.location.href = "login.html";
            return;
        }

        if(element.innerHTML === 'LOGOUT') {
            const flag = confirm("로그아웃 하시겠습니까?");
            if(flag) {
                localStorage.removeItem('loginInfo');
                loginMemberInfoDiv.innerHTML = '';
                loginText.innerHTML = 'LOGIN';
                joinText.innerHTML = 'JOIN';
                window.location.href = 'index.html';
            } else {
                return;
            }
        }
    };
    </script>
</body>
</html>